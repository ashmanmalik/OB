
<?php 

$url = "https://au-api.basiq.io/users/".$_GET['user']."/transactions?filter=account.id.eq(".$_GET['accountno'].")";
$curl = curl_init($url);
curl_setopt($curl, CURLOPT_URL, $url);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
$headers = array(
   "Accept: application/json",
   "Authorization: Bearer {$_GET['token']}",
);
curl_setopt($curl, CURLOPT_HTTPHEADER, $headers);
//for debug only!
curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, false);
curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false);

$resp = curl_exec($curl);
curl_close($curl);

$accounts = json_decode( $resp );


	$myObject = json_decode($resp, true);
	$transaction_data = $myObject["data"];
	$enrich_data = $myObject["data"]; 
	for ($i=0; $i<500; $i++) {
	  if ($enrich_data[$i]["enrich"]["location"]) { 
	    if($enrich_data[$i]["enrich"]["location"]["geometry"]) {
	    	if ($enrich_data[$i]["enrich"]["location"]["geometry"]["lat"] != "" && $enrich_data[$i]["enrich"]["location"]["geometry"]["lng"] != "") { 
				$lat = $enrich_data[$i]["enrich"]["location"]["geometry"]["lat"];
		    	$lon = $enrich_data[$i]["enrich"]["location"]["geometry"]["lng"];
		    	$planes[] = array($lat, $lon);
		      	

	    	}
	    }

	  }

	}
	//echo json_encode($planes);
?>
<!DOCTYPE html>
<html>
<head>
    <title> Simple Map </title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://d19vzq90twjlae.cloudfront.net/leaflet-0.7/leaflet.css" />
</head>
<body>

    <div id="map" style="width: 600px; height: 400px"></div>

    <script src="https://d19vzq90twjlae.cloudfront.net/leaflet-0.7/leaflet.js">
    </script>

    <script>
    //var planes = <?php echo json_encode($planes); ?>; 
	
    var planes = [
    ["-33.899629","151.0656538"],
    ["-28.0291428","153.4337534"],
    ["-37.7628123","144.9625895"],
    ["-33.78207","151.12602"],
    ["-36.39528654","145.35691709"],["-37.8364448","144.7083854"],["-33.921074","151.143087"],["-33.876154","151.244045"],["-33.817523","151.002711"],["-37.5941935","144.9147209"],["-37.8148346","144.9628429"],["-33.966068","151.105336"],["-37.8168616","144.9586239"],["-27.4534862","153.15602"],["-33.90674","151.1876467"],["-42.880245","147.406721"],["-33.82752","151.20117"],["-26.5736873","148.7863185"],["-33.817523","151.002711"],["-26.572381","148.7891"],["-37.8312912","144.9977944"],["-32.080219","115.988033"],["-27.6280868","153.1179062"],["-33.8813804","151.20949"],["-32.244772","148.595621"],["-37.8168616","144.9586239"],["-37.909279","144.67691"],["-37.891544","145.143489"],["-38.185376","146.235054"],["-27.5153","153.031"],["-34.563703","150.83896"],["-37.7663664","144.9616707"],["-33.940481","151.237811"],["-28.12275499999999","153.46157"],["-36.35423","146.323653"],["-28.2600877","152.0652545"],["-37.8364448","144.7083854"],["-37.8168616","144.9586239"],["-31.83122","115.802572"],["-38.14458700000001","144.362668"],["-33.754007","150.700446"],["-35.2784432","149.1265216"],["-33.9195683","151.0768304"],["-38.170484","144.391471"],["-37.8106752","144.9682788"],["-27.261182","152.9970448"],["-27.6365909","151.7437594"],["-33.89560549999999","151.0975061"],["-31.98389139","116.06486775"],["-33.8152924","151.19103"],["-16.99119112","145.7395144"],["-38.1704088","144.3494285"],["-37.8364448","144.7083854"],["-33.952538","151.135773"],["-37.8168616","144.9586239"],["-27.595723","152.959626"],["-37.8168616","144.9586239"],["-31.86466","115.80854"],["-41.425724262649","147.131636738780"],["-33.8747921","151.20495390000002"],["-37.8364448","144.7083854"],["-33.833009","151.0113036"],["-19.317302","146.727185"],["-37.9376","145.193"],["-33.9543598","150.8582761"],["-33.90674","151.1876467"],["-33.77645236","151.12019348"],["-27.320616","153.068932"],["-37.8096607","144.96766110000002"],["-33.74036","150.717478"],["-33.65659989999999","150.8741124"],["-33.8221128","151.0081769"],["-26.7566441","153.1270902"],["-33.8126758","151.0420979"],["-38.170484","144.391471"],["-33.8946431","151.1824201"],["-37.7121422","144.9863953"],["-37.8168616","144.9586239"],["-33.9067225","151.1723964"],["-37.8168616","144.9586239"],["-27.598672000000","152.959260000000"],["-33.9114424","151.1553238"],["-33.9026104","151.1945425"],["-33.7768932","151.1193707"],["-27.539206","153.082318"],["-37.02359","145.133598"],["-33.882941","151.174251"],["-33.88459009999999","151.1845418"],["-27.5605633","153.0836792"],["-33.86480239999999","151.2053478"],["-27.475065","153.015841"],["-34.010652","151.103184"],["-33.8760364","151.1896748"],["-33.9657184","151.1059862"],["-37.772831","144.949332"],["-27.469196","153.026772"],["-27.4497716","153.0438701"],["-37.805096","145.244137"],["-28.073834","153.44348"],["-33.90419799999999","151.168137"],["-27.617141","152.761574"],["-37.8168616","144.9586239"],["-32.9666754","151.6473931"],["-33.8900138","151.2723472"],["-37.53642","143.82198"],["-33.7545706","150.7061501"],["-33.78207","151.12602"],["-33.4258681","151.3440043"],["-33.886687","151.176631"],["-27.4801365","153.0222083"],["-33.866627","151.205139"],["-37.9178846","145.1557724"],["-32.074989","115.782165"],["-33.8720875","151.2098346"],["-33.834751","150.990932"],["-27.5531828","153.0866974"],["-33.88642959999999","151.179459"],["-33.8683524","151.2092406"],["-26.679578","153.1193001"],["-30.2981168","153.1140401"],["-33.8877441","151.18035"],["-33.8692689","151.1952441"],["-33.6756541","151.3089466"],["-33.866627","151.205139"],["-31.9493141","115.8589252"],["-33.85015372","151.03183666"],["-37.8168616","144.9586239"],["-33.7545664","151.2853483"],["-37.8168616","144.9586239"],["-33.8747921","151.20495390000002"],["-33.884502","151.204142"],["-37.598781","144.937434"],["-33.8703197","151.207366"],["-34.9275878","138.6108574"],["-33.9112356","151.162004"],["-33.870703","151.20707"],["-27.7330150","153.2279490"],["-38.096118","145.19853"],["-28.077581","153.3852008"],["-34.9422709","138.5626088"],["-37.8168616","144.9586239"],["-32.200096","152.519982"],["-37.8168616","144.9586239"],["-33.4377149","151.3930178"],["-33.93892","151.018251"],["-31.9524327","115.8576169"],["-31.8899884","116.0094037"],["-34.717651","138.666389"],["-37.8258094","144.9981272"],["-37.768231","145.041306"],["-34.6735445","138.6833666"],["-33.8988402","151.1722352"],["-33.796567","150.989235"],["-33.7725558","150.9686926"],["-27.4665394","153.1416662"],["-33.8685769","151.2081496"],["-33.7553905","150.7073071"],["-33.8753853","151.2237683"],["-33.87063589999999","151.2065993"],["-37.8168616","144.9586239"],["-37.765348","144.986191"],["-35.3365697","149.1787692"],["-33.884502","151.204142"],["-33.903259","151.185066"],["-34.1851655","142.160006"],["-33.9406624","151.2380885"],["-33.9344274","151.1828803"],["-33.866393","151.209717"],["-33.8703242","151.2068074"],["-33.766544","151.265216"],["-31.910675","115.814"],["-37.8111846","144.9691299"],["-37.8074","144.819"],["-37.803556","144.983284"],["-33.8369963","151.2061007"],["-37.918268","145.035868"],["-33.8761142","151.2082232"],["-27.9573516","153.4086071"],["-33.8761142","151.2082232"],["-33.877321","151.206106"],["-33.76955729999999","150.906451"],["-33.87277530000001","151.2071474"],["-33.7759825","151.1215299"],["-33.78207","151.12602"],["-31.84834","115.8253249"],["-33.8703197","151.207366"],["-27.4397486","153.0696257"],["-33.8747921","151.20495390000002"],["-37.564802","143.862673"],["-33.8703197","151.207366"],["-33.884502","151.204142"],["-38.3265025","144.3169477"],["-33.836654","151.207478"],["-37.907952787735","145.075256824490"],["-27.437954","153.025234"],["-37.8801863","145.022623"],["-37.817828","144.955601"],["-33.772191","151.079613"],["-33.906806","151.172538"],["-27.469196","153.026772"],["-33.913823","151.242274"],["-37.757017","145.124218"],["-33.1069884","151.4893292"],["-36.1383733","146.9092884"],["-33.888992","151.270189"],["-33.8703874","151.1931589"],["-33.884008","151.210326"],["-37.8123186","144.953017"],["-33.8792412","151.2056795"],["-34.033491","151.0580687"],["-33.8717902","151.2252032"],["-31.69194988","115.71742742"],["-33.766674","150.679611"],["-33.738598","151.125884"],["-16.9441306","145.7396573"],["-34.923454","138.594889"],["-33.7841818","151.1201763"],["-33.8683973","151.2092003"],["-27.4985506","153.0280375"],["-37.8168616","144.9586239"],["-37.773081","145.059325"],["-27.6575883","153.1712185"],["-31.9504330","115.8765900"],["-33.8768835","151.2048257"],["-33.88368799999999","151.194452"],["-37.774482","144.971399"],["-37.8261330","145.0001660"],["-33.9559352","150.8916821"],["-37.881082","145.16326"],["-34.426411","150.8963264"],["-33.757057","150.692839"],["-33.9344274","151.1828803"],["-42.88082","147.325547"],["-37.8771","145.12757"],["-33.8612742","121.893437"],["-33.884502","151.204142"],["-33.704725","151.099336"],["-37.8381046","144.9773182"],["-37.6288270","144.9480180"],["-37.811511","144.963551"],["-33.889379","151.124003"],["-33.8850286","151.1484491"],["-33.884747","151.177168"],["-33.894874","151.182019"],["-37.8168616","144.9586239"],["-33.88642959999999","151.179459"],["-27.5655900","152.9982770"],["-33.800175","151.286763"],["-32.034309","115.833918"],["-33.894874","151.182019"],["-34.2909097","150.5792688"],["-33.88642959999999","151.179459"],["-28.1634786","153.5487218"],["-32.262437","115.816178"],["-33.703593","151.10144"],["-32.0257100","115.9418320"],["-27.3302984","153.0263835"]]; 
	
	// //var planes = [
	// 	["7C6B07",-40.99497,174.50808],
	// 	["7C6B38",-41.30269,173.63696],
	// 	["7C6CA1",-41.49413,173.5421],
	// 	["7C6CA2",-40.98585,174.50659],
	// 	["C81D9D",-40.93163,173.81726],
	// 	["C82009",-41.5183,174.78081],
	// 	["C82081",-41.42079,173.5783],
	// 	["C820AB",-42.08414,173.96632],
	// 	["C820B6",-41.51285,173.53274]
	// 	];

        var map = L.map('map').setView([-33.899629, 151.0656538], 8);
        mapLink = 
            '<a href="https://openstreetmap.org">OpenStreetMap</a>';
        L.tileLayer(
            'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; ' + mapLink + ' Contributors',
            maxZoom: 18,
            }).addTo(map);

		for (var i = 0; i < planes.length; i++) {
			marker = new L.marker([planes[i][1],planes[i][2]])
				.bindPopup(planes[i][0])
				.addTo(map);
		}
// require_once __DIR__ . '/../vendor/autoload.php';

// Tracy\Debugger::enable(Tracy\Debugger::DEVELOPMENT);

// throw new RuntimeException('Hello Tracy!');
               
    </script>
</body>
</html>
